<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ğŸŒŸå¤§å­¸æ˜Ÿç”Ÿæ´»ğŸŒŸåˆ®åˆ®å¡</title>
<style>
  body { margin:0; padding:0; font-family:Arial,sans-serif; background:#f8f8f8; text-align:center; }
  h1 { margin:15px 0; color:#333; font-size:clamp(20px,5vw,32px); }
  #wrapper { position:relative; display:inline-block; width:95vw; max-width:400px; margin:auto; }
  canvas { border:2px solid #ccc; border-radius:12px; display:block; width:100%; height:auto; }
</style>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>
<h1>ğŸŒŸå¤§å­¸æ˜Ÿç”Ÿæ´»ğŸŒŸ</h1>
<div id="wrapper">
  <canvas id="bgCanvas"></canvas>
  <canvas id="maskCanvas" style="position:absolute;top:0;left:0;"></canvas>
</div>

<script>
// ===== å‹è™Ÿå°ç…§è¡¨ =====
const modelMap = {
  // Galaxy S ç³»åˆ—
  "SM-G9800": "Galaxy S20",
  "SM-G9860": "Galaxy S20+",
  "SM-G9880": "Galaxy S20 Ultra",
  "SM-G9910": "Galaxy S21",
  "SM-G9960": "Galaxy S21+",
  "SM-G9980": "Galaxy S21 Ultra",
  "SM-S9010": "Galaxy S22",
  "SM-S9060": "Galaxy S22+",
  "SM-S9080": "Galaxy S22 Ultra",
  "SM-S9110": "Galaxy S23",
  "SM-S9160": "Galaxy S23+",
  "SM-S9180": "Galaxy S23 Ultra",
  "SM-S9210": "Galaxy S24",
  "SM-S9260": "Galaxy S24+",
  "SM-S9280": "Galaxy S24 Ultra",
  "SM-S9310": "Galaxy S25",
  "SM-S9360": "Galaxy S25+",
  "SM-S9380": "Galaxy S25 Ultra",

  // Galaxy Z ç³»åˆ—
  "SM-F7000": "Galaxy Z Flip",
  "SM-F9160": "Galaxy Z Fold2",
  "SM-F7110": "Galaxy Z Flip3",
  "SM-F9260": "Galaxy Z Fold3",
  "SM-F7210": "Galaxy Z Flip4",
  "SM-F9360": "Galaxy Z Fold4",
  "SM-F7310": "Galaxy Z Flip5",
  "SM-F9460": "Galaxy Z Fold5",
  "SM-F7410": "Galaxy Z Flip6",
  "SM-F9560": "Galaxy Z Fold6",

  // Galaxy A ç³»åˆ—
  "SM-A5150": "Galaxy A51",
  "SM-A7150": "Galaxy A71",
  "SM-A3250": "Galaxy A32",
  "SM-A5250": "Galaxy A52",
  "SM-A5260": "Galaxy A52 5G",
  "SM-A7250": "Galaxy A72",
  "SM-A2660": "Galaxy A26 5G",
  "SM-A3360": "Galaxy A33 5G",
  "SM-A3660": "Galaxy A36 5G",
  "SM-A5360": "Galaxy A53 5G",
  "SM-A5660": "Galaxy A56 5G",
  "SM-A7360": "Galaxy A73 5G",
  "SM-A1460": "Galaxy A14 5G",
  "SM-A2450": "Galaxy A24",
  "SM-A3460": "Galaxy A34 5G",
  "SM-A5460": "Galaxy A54 5G",
  "SM-A3560": "Galaxy A35 5G",
  "SM-A5560": "Galaxy A55 5G",
  "SM-A1660": "Galaxy A16",

  // å·²æœ‰çš„æ©Ÿç¨®
  "iPhone": "Apple iPhoneï¼ˆå‹è™ŸæœªçŸ¥ï¼‰",
  "Pixel 7": "Google Pixel 7",
  "Pixel 7 Pro": "Google Pixel 7 Pro",
  "Pixel 8": "Google Pixel 8",
  "Pixel 8 Pro": "Google Pixel 8 Pro",
  "Pixel 9": "Google Pixel 9",
  "Pixel 9 Pro": "Google Pixel 9 Pro",
  "OnePlus 9": "OnePlus 9",
  "OnePlus 10": "OnePlus 10",
  "OnePlus 11": "OnePlus Buds",
  "OnePlus 13": "OnePlus 13",
  "XQ-DC72": "Sony Xperia 1 V",
  "XQ-DQ72": "Sony Xperia 5 V",
  "23078PND5G": "Xiaomi 13T Pro",
  "22071212AG": "Xiaomi 12T Pro",
  "23021RAA2Y": "Redmi Note 12",
  "23090RA98G": "Redmi Note 13 Pro",
  "AI2205": "ASUS ROG Phone 6",
  "AI2401": "ASUS ROG Phone 8",
  "AI2302": "ASUS Zenfone 10",
  "CPH2491": "OPPO Reno10",
  "CPH2525": "OPPO Find X6",
  "V2238": "vivo X90",
  "V2303": "vivo Y78",
  "RMX3820": "realme 11 Pro+",
  "RMX3866": "realme GT Neo5"
};


// ===== å‹è™Ÿåµæ¸¬ =====
function guessModelName(rawModel){
  if(!rawModel) return "æœªçŸ¥æ©Ÿå‹";
  const key = rawModel.toUpperCase().replace(/\s+/g,'');
  return modelMap[key] || rawModel;
}
function detectBrand(modelCode){
  const code = modelCode.toUpperCase();
  if(code.startsWith("SM-")) return "Samsung";
  if(code.includes("IPHONE")) return "Apple";
  if(code.includes("PIXEL")) return "Google";
  if(code.includes("ONEPLUS")) return "OnePlus";
  if(code.includes("OPPO")) return "OPPO";
  if(code.includes("ASUS")) return "ASUS";
  if(code.includes("VIVO")) return "vivo";
  if(code.includes("REALME")) return "realme";
  return "Android";
}
function getAndroidModel(ua){
  let match = ua.match(/android.*;\s([^;]+)\sbuild/i);
  if(match && match[1]) return match[1].trim();
  match = ua.match(/android.*;\s([^;]+)\)/i);
  if(match && match[1]) return match[1].trim();
  return "Androidè£ç½®";
}
function getDeviceInfo(){
  const ua=navigator.userAgent.toLowerCase();
  if(ua.includes('iphone')){ deviceBrand='Apple'; deviceModel='iPhone'; }
  else if(ua.includes('ipad')){ deviceBrand='Apple'; deviceModel='iPad'; }
  else if(ua.includes('android')){
    const model = getAndroidModel(ua);
    deviceModel = guessModelName(model);
    deviceBrand = detectBrand(model);
  } else { deviceBrand='æœªçŸ¥'; deviceModel='æœªçŸ¥'; }
}

// ===== Firebase è¨­å®š =====
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
  databaseURL: "https://guaguaca-b97ad-default-rtdb.asia-southeast1.firebasedatabase.app/",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT_ID.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();

// ===== LIFF è¨­å®š =====
const LIFF_ID = '2007597530-o1xaVbZm';

// ===== DOM =====
const wrapper=document.getElementById('wrapper');
const bgCanvas=document.getElementById('bgCanvas');
const maskCanvas=document.getElementById('maskCanvas');
const bgCtx=bgCanvas.getContext('2d');
const maskCtx=maskCanvas.getContext('2d');

let deviceBrand='æœªçŸ¥', deviceModel='æœªçŸ¥', userId='æœªçŸ¥', prize='';

// ===== åœ–ç‰‡è¨­å®š =====
const images = {
  'å¤©é¸çS1':'https://i.postimg.cc/RCGKq4nk/6.png',
  'å¤©é¸çS2':'https://i.postimg.cc/gkxjRNkf/5.png',
  'æ©Ÿæœƒç':'https://i.postimg.cc/3xpwfNG1/3.png',
  'å‘½é‹ç':'https://i.postimg.cc/RFCV0TDp/2.png'
};

// ===== ç•«å¸ƒ =====
function setCanvasSize(){
  const width = wrapper.clientWidth;
  const height = Math.floor(width*1350/1080);
  wrapper.style.height=height+'px';
  bgCanvas.width=maskCanvas.width=width;
  bgCanvas.height=maskCanvas.height=height;
}
function initMask(){
  maskCtx.fillStyle='#999';
  maskCtx.fillRect(0,0,maskCanvas.width,maskCanvas.height);
}
const img=new Image();
img.crossOrigin='anonymous';
img.src=images['æ©Ÿæœƒç'];
img.onload=()=>{
  setCanvasSize();
  bgCtx.drawImage(img,0,0,bgCanvas.width,bgCanvas.height);
  initMask();
};
window.addEventListener('resize',()=>{
  setCanvasSize();
  bgCtx.drawImage(img,0,0,bgCanvas.width,bgCanvas.height);
  initMask();
});

// ===== æŠ½çé‚è¼¯ =====
async function drawLottery(){
  try{
    const quotasSnap = await db.ref('lottery-quotas').get();
    const quotas = quotasSnap.val();
    const rand = Math.random();
    if(rand<1/303 && quotas['å¤©é¸çS1']>0) prize='å¤©é¸çS1';
    else if(rand<1/303 && quotas['å¤©é¸çS2']>0) prize='å¤©é¸çS2';
    else{
      let normal=[];
      if(quotas['æ©Ÿæœƒç']>0) normal.push('æ©Ÿæœƒç');
      if(quotas['å‘½é‹ç']>0) normal.push('å‘½é‹ç');
      prize=normal[Math.floor(Math.random()*normal.length)];
    }
    // æ‰£é™¤åé¡
    await db.ref('lottery-quotas/'+prize).transaction(c=> (c||0)>0?c-1:0);
    // è¨˜éŒ„æŠ½ç
    await db.ref('lottery-records/'+userId).set({
      prize: prize,
      deviceBrand: deviceBrand,
      deviceModel: deviceModel,
      timestamp: Date.now()
    });
  }catch(e){ console.error(e); prize='æ©Ÿæœƒç'; }
}

// ===== åˆå§‹åŒ– =====
async function initLiff(){
  await liff.init({liffId:LIFF_ID});
  if(!liff.isLoggedIn()) liff.login();
  else{
    try{ const profile = await liff.getProfile(); userId = profile.userId || 'æœªçŸ¥'; } catch{}
    getDeviceInfo();
    await drawLottery(); // ä¸€é–‹ç¶²é å°±æŠ½
  }
}
initLiff();
</script>
</body>
</html>
